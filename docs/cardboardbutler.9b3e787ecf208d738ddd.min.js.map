{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./index.tsx","webpack:///./components/App.tsx","webpack:///./services/BggGameService.ts","webpack:///./components/CollectionPage.tsx","webpack:///./services/GamesFilterAndSorter.ts","webpack:///./services/BggGameLoader.ts","webpack:///./components/ValidatingUserInput.tsx","webpack:///./styles/App.css?f1c1","webpack:///./styles/App.css"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","rootEl","document","getElementById","render","AppContainer","WelcomePage","userValidator","onNameSelect","showWarning","className","Header","as","Message","MemoizedWelcomePage","React","memo","initialState","names","games","loadingInfo","showingCollection","showBackoff","superProps","collectionMerger","CollectionMerger","handleHashChange","bggService","bggServce","loader","onGamesUpdate","_ismounted","setState","onLoadUpdate","loadinfo","state","addEventListener","componentDidMount","this","hashValue","location","hash","substr","indexOf","usernames","substring","split","componentWillUnmount","removeEventListener","getBggService","props","newNames","join","loadCollections","then","loadExtendedInfo","loadPlays","getUserInfo","res","isValid","error","allGoodAgain","loadingCollections","filter","li","type","map","username","isLoadingCollections","loadingGames","loadingPlays","progressStyle","position","borderRadius","bottom","height","left","right","padding","backgroundColor","Dimmer","active","inverted","Loader","content","currentUsers","style","inline","Progress","indicating","total","progress","lp","Component","fetchService","fetch","getUserCollection","fetchCollectionXml","xmlResult","undefined","jsObj","convert","xml2js","elements","item","valueOf","attributeName","getTagValue","playStats","getPlayStatsFromCollection","yearAsString","yearAsNumber","parseInt","gameId","attributes","objectid","assign","id","averagerating","getAverageRating","thumbnailUrl","yearPublished","imageUrl","families","getFamilies","userRating","getUserRating","fetUserInfoXml","xml","getGamesInfo","ids","fetchGamesXml","elementToExtendedInfo","getPlays","getPlaysPage","firstPage","plays","totalPlays","numberOfPagesMissing","Math","ceil","missingPagesPromises","Array","fill","_","Promise","all","missingPagesResults","missingPagesPlays","reduce","prev","cur","concat","pageNumber","fetchPlaysXml","mainPlayElement","itemElements","toString","elementToPlayInfo","mainElement","date","Date","playId","quantity","mainElements","suggesteNumberOfPlayersMap","find","e","numOfPlayersString","numplayers","numberOfPlayers","Infinity","getNumberOfVotes","resultType","best","recommended","notRecommended","snp","getLinkValues","typeName","description","text","trim","weight","parseFloat","mechanics","categories","suggestedNumberOfPlayers","getFetch","stringValue","getRatingElement","getStatsElement","attr","parseAsInt","minPlayers","numberOwned","maxPlayers","minPlaytime","maxPlaytime","playingTime","ratingString","rating","getRanks","element","friendlyName","friendlyname","bayesaverage","tags","tagName","tagElement","url","buildCollectionUrl","fethXml","buildGameUrls","buildPlaysUrl","status","retryLater","backoff","buildUserUrl","baseUrl","BggGameService","ratingNames","reverse","weightName","getWeightInfo","gameInfo","weightIndex","round","max","toLowerCase","generateDescription","getRatingDescription","family","getFamilyDescription","players","getPlayerInfoString","playtime","getTimeInfoString","firstString","getAOrAn","hasWeight","isVowel","input","charAt","sort","a","b","endsWith","ratingValue","ratingIndex","ratingInfo","playerInfo","timeInfo","mintime","maxtime","DescriptionGenerator","playercountOptions","playercount","filterBarInitialState","filterOptions","getSortOptionFromIndex","getSortOptionFromIndexSingle","getDropdownValues","getSortOptions","getOptions","minimum","maximum","options","sortOption","allowMultiSelect","isArray","iWe","sortingOptions","sortoption","singlePreferenceOption","multiPreferenceOption","onTimeChange","timerIndex","option","combineState","onPlayerCountChange","playerCountIndex","playerCount","so","onSortChange","sortOptionIndex","currentOption","newFilter","onFilterChange","joinWithAndEnd","strings","newStrings","last","pop","findIndex","oneUser","amAre","values","timeOptions","Container","fluid","href","Dropdown","placeholder","closeOnChange","onChange","_e","multiple","FilterBar","gameDescription","size","owners","Item","Image","src","Content","verticalAlign","target","Meta","Description","Extra","PureComponent","GameListItem","Card","wrapped","ui","extra","pickAGameInitialState","pickedGame","gamesAlreadyShown","pickARandomGame","close","gamesToPickFrom","gameToPossiblyPickFrom","every","alreadyShownGame","randomIndex","randomInteger","min","from","to","floor","random","onClick","Segment","Group","Button","color","stopPropagation","Icon","basic","game","centered","GameCardItem","icon","textAlign","circular","Divider","List","horizontal","hidden","onSetViewType","viewType","filteredGames","GamesFilterAndSorter","filterAndSort","noGames","top","bordered","NoGamesFound","PickAGameForMe","CollectionList","CollectionGrid","Footer","memoize","collection","averageRatingSorter","BggRatingSorter","weightHeavySort","aValue","HeavySorter","weightLightSort","LightSorter","innerSorters","mutableCollection","multiScoreMap","sorter","index","keys","forEach","combinedComparator","createCompareWithMap","indexMap","score","MultiSorter","nameSorter","localeCompare","NameSorter","oldYearSorter","getSafePlayCount","OldSorter","recentlySoter","getSafeLastPlayed","lastPlayed","getTime","PlayedALotSorter","PlayedLongAgoSorter","PlayedNotALotSorter","RecentlyPlayedSorter","getSuggestedComparatorComparator","getSuggestePlayerScore","votes","SuggestedPlayersSorter","userRatingSorter","aRating","getAverageUserRating","scoreMap","userNamesWithRatings","UserRatingSorter","newYearSorter","YoungSorter","sortMap","alphabetic","bggrating","new","old","userrating","getSorterInner","getSorter","sortCollection","sortCollectionInner","GameSorter","filterCollectionInner","filterCollection","filterOnTime","filterOnPlayerCount","GameFilterer","filterer","filterAndSortInner","collectionCopy","filtered","getMergedCollection","getMergedCollectionInner","collectionsMap","cache","sharedUserRatingSet","Set","currentGame","alreadyKnownGame","has","add","merger","useCache","collectionMap","extraInfoMap","playsMap","currentNames","eventHandlers","loadingEventHandlers","concurrentRequestLimit","service","loadCollectionWithRetry","getAllGamesPlus","getAllGamesPlusPure","informCollectionUpdateHandlers","getAllGamesPlusPureMemo","getShownGamesMapMemo","getShownGamesMap","getGamesWithExtraInfoMemo","getGamesWithExtraInfo","getGamesWithPlayInfoMemo","getGamesWithPlayInfo","loadCollectionsFromCache","loadExtraInfo","setStorageVersion","storeCollections","allGames","allUnknownGames","isLoading","gameinfo","chunks","chunk","unknownGames","loadGamesWithRetry","extraInfos","extraInfo","storeExtraInfo","chunkSize","chunked_arr","copied","numOfChild","localStorage","setItem","JSON","stringify","getItem","removeItem","parse","known","ag","allPlaysOfGame","usersPlays","usersPlay","playedBy","lastPlayInMinutes","timePlayedInMinutes","timePlayedMinutes","shownGamesMap","allGamesPlus","handler","informLoadingHandlers","getLoadingInfo","loadPlaysWithRetry","playerPlays","retryTime","resolver","setTimeout","g","loadingIndex","retryInfo","extendeds","onInputChange","getNamesToShow","onAddClick","onDeleteClick","onUseClick","onNameChange","bggNames","clone","newNamesToShow","namesToShow","showDelete","validNames","loadingNames","hasEnoughNames","forwardButtonText","canUseNames","isLast","inputName","isValidLabel","removeButton","cursor","Input","labelPosition","label","loading","autoFocus","disabled","SelectUserInput","shownNames","invalidNames","onNamesChange","doesNameNeedValidation","isNameShown","setNameLoading","setNameValidity","loadingName","marginTop","api","default","locals","___CSS_LOADER_API_IMPORT___"],"mappings":"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","file":"cardboardbutler.9b3e787ecf208d738ddd.min.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([291,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import * as React from \"react\";\nimport { render } from \"react-dom\";\nimport { AppContainer } from \"react-hot-loader\";\nimport App from \"./components/App\";\nimport \"./styles/App.css\";\n\nconst rootEl = document.getElementById(\"content\");\n\nrender(\n    <AppContainer>\n        <App />\n    </AppContainer>,\n    rootEl\n);\n\n// Hot Module Replacement API\ndeclare let module: { hot: any };\n\nif (module.hot) {\n    module.hot.accept(\"./components/App\", () => {\n        const NewApp = require(\"./components/App\").default;\n\n        render(\n            <AppContainer>\n                <NewApp />\n            </AppContainer>,\n            rootEl\n        );\n    });\n}\n","import * as React from \"react\";\nimport BggGameService from \"../services/BggGameService\";\nimport { GameInfoPlus } from \"../types\";\nimport CollectionPage from \"./CollectionPage\";\nimport BggGameLoader, { LoadingInfo, PlaysLoadingInfo, CollectionMerger } from \"../services/BggGameLoader\";\nimport { Dimmer, Loader, Progress, Header, Message } from \"semantic-ui-react\";\nimport ValidatingUserInput from \"./ValidatingUserInput\";\n\n// --- WelcomePage Component ---\n\ninterface WelcomePageProps {\n    onNameSelect: (names: string[]) => any;\n    userValidator: (name: string) => Promise<boolean>;\n    showWarning?: boolean;\n}\n\nconst WelcomePage: React.FC<WelcomePageProps> = ({ userValidator, onNameSelect, showWarning }) => {\n    return (\n        <div className=\"ui middle aligned center aligned grid givenames\" data-testid=\"WelcomePage\">\n            <div className=\"column\">\n                <div>\n                    <Header as=\"h3\">\n                        <span>Good day, how can I help you today?</span>\n                    </Header>\n                </div>\n                <div className=\"ui large form\" >\n                    <div className=\"ui\">\n                        <ValidatingUserInput\n                            userValidator={userValidator}\n                            onNameSelect={onNameSelect}\n                        />\n                    </div>\n                </div>\n                {showWarning && <Message>\n                    <Message.Header>BGG is taking a breather</Message.Header>\n                    <p>\n                        Boardgame Geek has a limit on how many requests I can make.\n                        Unfortunatly the limit has been hit for a while, so try agian in a couple of minutes (or 10).\n                    </p>\n                </Message>}\n            </div>\n        </div>\n    );\n};\n\nconst MemoizedWelcomePage = React.memo(WelcomePage);\n\n// --- App Component ---\n\nexport interface AppProps {\n    bggServce?: BggGameService;\n}\n\n\nexport interface AppState {\n    names: string[];\n    games: GameInfoPlus[];\n    loadingInfo: LoadingInfo[];\n    showingCollection: boolean;\n    showBackoff: boolean;\n}\n\nconst initialState: AppState = { names: [], games: [], loadingInfo: [], showingCollection: false, showBackoff: false };\n\n\nexport default class App extends React.Component<AppProps, AppState> {\n\n    private collectionMerger: CollectionMerger;\n    private readonly loader: BggGameLoader;\n\n    constructor(superProps: Readonly<AppProps>) {\n        super(superProps);\n        this.collectionMerger = new CollectionMerger();\n\n        this.onNameSelect = this.onNameSelect.bind(this);\n        this.userValidator = this.userValidator.bind(this);\n        this.handleHashChange = this.handleHashChange.bind(this);\n        const bggService = superProps.bggServce || new BggGameService();\n        this.loader = new BggGameLoader(bggService, this.collectionMerger, true);\n        this.loader.onGamesUpdate((games) => {\n            if (this._ismounted) {\n                this.setState({ games: games, showingCollection: true });\n            }\n        });\n        this.loader.onLoadUpdate((loadinfo) => {\n            if (this._ismounted) {\n                this.setState({ loadingInfo: loadinfo });\n            }\n        });\n        this.state = initialState;\n        window.addEventListener(\"hashchange\", this.handleHashChange, false);\n    }\n\n    private _ismounted: boolean;\n\n\n    componentDidMount() {\n        this._ismounted = true;\n        this.handleHashChange();\n    }\n\n    handleHashChange() {\n        const hashValue = window.location.hash.substr(0);\n        if (hashValue && hashValue !== \"\" && hashValue.indexOf(\"usernames=\") > -1) {\n            const usernames = hashValue.substring(\"usernames=\".length + 1).split(\",\");\n            this.onNameSelect(usernames);\n        } else {\n            this.setState(initialState);\n        }\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener(\"hashchange\", this.handleHashChange, false);\n        this._ismounted = false;\n    }\n\n    getBggService() {\n        return this.props.bggServce || new BggGameService();\n    }\n\n\n    onNameSelect(newNames: string[]) {\n        if (newNames.join(\",\") !== this.state.names.join(\",\")) {\n            this.setState({\n                names: newNames\n            });\n            window.location.hash = \"usernames=\" + newNames.join(\",\");\n            if (this._ismounted) {\n                this.loader.loadCollections(newNames).then(() => {\n                    this.loader.loadExtendedInfo().then(() => {\n                        this.loader.loadPlays();\n                    });\n                });\n            }\n        }\n    }\n\n\n    async userValidator(name: string) {\n        const res = await this.getBggService().getUserInfo(name);\n        const beingToldToBackOff = res.isValid === \"unknown\" && res.error === \"backoff\";\n        if (beingToldToBackOff) {\n            this.setState({ showBackoff: true });\n            return false;\n        } else {\n            const allGoodAgain = res.isValid === true;\n            if (allGoodAgain) {\n                this.setState({ showBackoff: false });\n            }\n            return allGoodAgain;\n        }\n    }\n\n    render() {\n        const { loadingInfo = [], games, showingCollection, names, showBackoff } = this.state;\n        const loadingCollections = loadingInfo.filter((li) => li.type === \"collection\").map((c) => c.type === \"collection\" ? c.username : \"\");\n        const isLoadingCollections = loadingCollections.length > 0;\n        const loadingGames = loadingInfo.filter((li) => li.type === \"game\");\n        const loadingPlays = loadingInfo.filter((li) => li.type === \"plays\") as PlaysLoadingInfo[];\n        const progressStyle: React.CSSProperties = { position: \"fixed\", borderRadius: 30, bottom: 0, height: 120, left: \"20%\", right: \"20%\", padding: 40, backgroundColor: \"white\" };\n        return (\n            <span >\n                {!showingCollection && !isLoadingCollections && <MemoizedWelcomePage onNameSelect={this.onNameSelect} userValidator={this.userValidator} showWarning={showBackoff} />}\n                {isLoadingCollections && games.length === 0 && <Dimmer active inverted>\n                    <Loader inverted content={\"Finding games for \" + loadingCollections.join(\", \")} />\n                </Dimmer>\n                }\n\n                {games.length > 0 && showingCollection && <CollectionPage currentUsers={this.state.names} games={games} />}\n                {isLoadingCollections && games.length > 0 &&\n                    <div style={progressStyle}>\n                        <Loader active inline=\"centered\" content={\"Finding games for \" + loadingCollections.join(\", \")} />\n                    </div>\n                }\n                {games.length > 0 && loadingGames.length > 0 &&\n                    < div style={progressStyle}>\n                        <Progress indicating value={games.length - loadingGames.length} total={games.length} progress=\"ratio\">\n                            Getting more game info\n                    </Progress>\n                    </div>\n                }\n\n                {games.length > 0 && loadingPlays.length > 0 &&\n                    < div style={progressStyle}>\n                        <Progress indicating value={names.length - loadingPlays.length} total={names.length} progress=\"ratio\">\n                            Finding plays for {loadingPlays.map((lp) => lp.username).join(\", \")}\n                        </Progress>\n                    </div>\n                }\n\n            </span>\n        );\n    }\n}\n","import { FetchService } from \"../types\";\nimport * as convert from \"xml-js\";\nimport { GameInfo, ExtendedGameInfo, SuggestedNumberOfPlayersMap, PlayInfo } from \"../types\";\nimport { UserInfo } from \"../types\";\n\n\nexport type BggRetryResult = { retryLater: boolean, backoff?: boolean, error?: Error };\n/**\n * A service that can wraps the BGG Api.\n * It does not cache, or handle retries, it simple transform the bgg api into xml\n * Be adviced: This uses a CORS proxy, to get around the BGG API not providing CORS information.\n */\nclass BggGameService {\n\n    private fetchService: FetchService;\n\n    /**\n     * Construct a new bgg game service.\n     * @param fetchService the service to use when trying to fetch information from bgg. If none is given the browser global fetch will be used.\n     */\n    constructor(fetchService?: FetchService) {\n        this.fetchService = fetchService || fetch;\n    }\n\n    /**\n     * Gets a collection of the owned games from a user.\n     * @param username username of the user whose collection to get.\n     * @returns Either a list of game infromation, or a bgg retry result, if there is an error or bgg needed time to generate the list.\n     */\n    async getUserCollection(username: string): Promise<BggRetryResult | GameInfo[]> {\n        const xmlResult = await this.fetchCollectionXml(username);\n        if (typeof xmlResult !== \"string\") {\n            return xmlResult;\n        }\n        const jsObj = convert.xml2js(xmlResult);\n        if (jsObj.elements === undefined) {\n            return [];\n        }\n        const allItems: convert.Element[] = jsObj.elements[0].elements;\n        return allItems.map((item: convert.Element) => {\n            const elements = item.elements;\n            const valueOf = (attributeName: string) => this.getTagValue(elements, attributeName);\n            const playStats = this.getPlayStatsFromCollection(elements);\n            const yearAsString: string | undefined = valueOf(\"yearpublished\");\n            const yearAsNumber = yearAsString === undefined ? undefined : parseInt(yearAsString, 10);\n            const gameId = parseInt(item.attributes.objectid as string);\n            const game: GameInfo = Object.assign({\n                id: gameId,\n                averagerating: this.getAverageRating(elements),\n                name: valueOf(\"name\"),\n                thumbnailUrl: valueOf(\"thumbnail\"),\n                yearPublished: yearAsNumber,\n                imageUrl: valueOf(\"image\"),\n                families: this.getFamilies(elements),\n                userRating: this.getUserRating(username, elements)\n            }, playStats);\n            return game;\n        });\n    }\n\n    /**\n     * Get user information about a given useranme.\n     * If a username is given that does not excist then \"isValid:true\" will be returned.\n     * If the call to bgg fails, then \"isValid:unknown\" is returend, as the service cannot know if the name is valid.\n     * @param username the username to get information for\n     */\n    async getUserInfo(username: string): Promise<UserInfo> {\n        const xml = await this.fetUserInfoXml(username);\n        if (typeof xml !== \"string\") {\n            return {\n                isValid: \"unknown\",\n                error: xml.error\n            };\n        }\n        const jsObj = convert.xml2js(xml);\n        if (jsObj.elements) {\n            const attributes = jsObj.elements[0].attributes;\n            const id = attributes.id;\n            if (id !== \"\") {\n                const name = attributes.name;\n                return {\n                    isValid: true,\n                    username: name\n                };\n            }\n        }\n        return {\n            isValid: false\n        };\n    }\n\n\n    async getGamesInfo(ids: number[]): Promise<BggRetryResult | ExtendedGameInfo[]> {\n        const xml = await this.fetchGamesXml(ids);\n        if (typeof xml === \"string\") {\n            const jsObj = convert.xml2js(xml) as convert.Element;\n            const itemElements = jsObj.elements[0].elements;\n            return itemElements.map((this.elementToExtendedInfo));\n        } else {\n            return xml;\n        }\n    }\n\n\n\n    async getPlays(username: string): Promise<BggRetryResult | PlayInfo[]> {\n        const firstPage = await this.getPlaysPage(username);\n        if (\"plays\" in firstPage) {\n            const { plays, totalPlays } = firstPage;\n            const needMorePlays = firstPage.totalPlays > firstPage.plays.length;\n            if (needMorePlays) {\n                const numberOfPagesMissing = Math.ceil(totalPlays / plays.length) - 1;\n                const missingPagesPromises = new Array(numberOfPagesMissing).fill(0).map((_, i) => this.getPlaysPage(username, i + 2)); // start at index 2, we already have page 1\n                const missingPagesResults = await Promise.all(missingPagesPromises);\n                const missingPagesPlays = missingPagesResults.reduce((prev, cur) => (\"plays\" in cur) ? prev.concat(cur.plays) : prev, [] as PlayInfo[]);\n                return [...plays, ...missingPagesPlays];\n            } else {\n                return plays;\n            }\n        } else {\n            return firstPage;\n        }\n\n    }\n\n    async getPlaysPage(username: string, pageNumber = 1) {\n        const xml = await this.fetchPlaysXml(username, pageNumber);\n        if (typeof xml === \"string\") {\n            const jsObj = convert.xml2js(xml) as convert.Element;\n            const mainPlayElement = jsObj.elements[0];\n            if (mainPlayElement.elements === undefined) {\n                return {\n                    totalPlays: 0,\n                    pageNumber: pageNumber,\n                    plays: []\n                };\n            }\n            const itemElements = mainPlayElement.elements;\n            const totalPlays = parseInt(mainPlayElement.attributes[\"total\"].toString());\n            return {\n                totalPlays: totalPlays,\n                pageNumber: pageNumber,\n                plays: itemElements.map(this.elementToPlayInfo)\n            };\n        } else {\n            return xml;\n        }\n    }\n\n    private elementToPlayInfo(mainElement: convert.Element): PlayInfo {\n\n        return {\n            date: new Date(mainElement.attributes[\"date\"]),\n            gameId: parseInt(mainElement.elements[0].attributes[\"objectid\"].toString()),\n            length: parseInt(mainElement.attributes[\"length\"].toString()),\n            playId: parseInt(mainElement.attributes[\"id\"].toString()),\n            quantity: parseInt(mainElement.attributes[\"quantity\"].toString()),\n        };\n\n    }\n\n\n\n    private elementToExtendedInfo(mainElement: convert.Element): ExtendedGameInfo {\n        const mainElements = mainElement.elements;\n        const suggestedplayersElement = mainElements.find((e) => e.name === \"poll\" && e.attributes.name === \"suggested_numplayers\");\n        const suggestedNumberOfPlayersArray = suggestedplayersElement.elements.map((e) => {\n            const numOfPlayersString = e.attributes.numplayers.toString();\n            const numberOfPlayers = numOfPlayersString.indexOf(\"+\") > -1 ? Infinity : parseInt(numOfPlayersString, 10);\n            const getNumberOfVotes = (resultType: string) => parseInt(e.elements.find((e) => e.name === \"result\" && e.attributes[\"value\"].toString() === resultType).attributes.numvotes as string);\n            if (e.elements) {\n                const best = getNumberOfVotes(\"Best\");\n                const recommended = getNumberOfVotes(\"Recommended\");\n                const notRecommended = getNumberOfVotes(\"Not Recommended\");\n                return {\n                    numberOfPlayers: numberOfPlayers,\n                    best: best,\n                    recommended: recommended,\n                    notRecommended: notRecommended\n                };\n            }\n            return undefined;\n\n        });\n        const suggesteNumberOfPlayersMap: SuggestedNumberOfPlayersMap = suggestedNumberOfPlayersArray.filter((snp) => snp).reduce((p, c) => Object.assign(p, { [c.numberOfPlayers]: c }), {});\n        const getLinkValues = (typeName: string) => mainElements.filter((e) => e.name === \"link\" && e.attributes[\"type\"] === typeName).map((e) => e.attributes[\"value\"].toString());\n        return {\n            description: mainElements.find((e) => e.name === \"description\").elements[0].text.toString().trim(),\n            weight: parseFloat(mainElements.find((e) => e.name === \"statistics\").elements[0].elements.find((e) => e.name === \"averageweight\").attributes[\"value\"].toString().trim()),\n            mechanics: getLinkValues(\"boardgamemechanic\"),\n            categories: getLinkValues(\"boardgamecategory\"),\n            suggestedNumberOfPlayers: suggesteNumberOfPlayersMap\n        };\n    }\n\n\n    private getFetch() {\n        return this.fetchService;\n    }\n\n    private getAverageRating(elements: convert.Element[]) {\n        const stringValue = this.getRatingElement(elements).elements.find((t) => t.name === \"average\").attributes.value;\n        return parseFloat(stringValue.toString());\n    }\n\n    private getStatsElement(elements: convert.Element[]) {\n        return elements.find((t) => t.name === \"stats\");\n    }\n\n    private getRatingElement(elements: convert.Element[]) {\n        return this.getStatsElement(elements).elements[0];\n    }\n\n    private getPlayStatsFromCollection(elements: convert.Element[]) {\n        const stats = this.getStatsElement(elements);\n        const attr = stats.attributes;\n        const parseAsInt = (name: string) => attr[name] && parseInt(attr[name].toString());\n        return {\n            minPlayers: parseAsInt(\"minplayers\"),\n            numberOwned: parseAsInt(\"numowned\"),\n            maxPlayers: parseAsInt(\"maxplayers\"),\n            minPlaytime: parseAsInt(\"minplaytime\"),\n            maxPlaytime: parseAsInt(\"maxplaytime\"),\n            playingTime: parseAsInt(\"playingtime\")\n        };\n    }\n    private getUserRating(username: string, elements: convert.Element[]) {\n        const ratingElement = this.getRatingElement(elements);\n        const ratingString = ratingElement.attributes[\"value\"] as string;\n        const rating = (ratingString === \"N/A\" || ratingString === undefined) ? null : parseFloat(ratingString);\n        const result = {};\n        result[username] = rating;\n        return result;\n    }\n\n\n    private getFamilies(elements: convert.Element[]) {\n        const ranks = this.getRanks(elements);\n        return ranks.filter((r) => r.type === \"family\");\n    }\n\n\n    private getRanks(elements: convert.Element[]) {\n        const ratings = this.getRatingElement(elements);\n        const ranks = ratings.elements.find((t) => t.name === \"ranks\").elements;\n        return ranks.map((element) => {\n            const attributes = element.attributes;\n            return {\n                name: attributes.name.toString(),\n                friendlyName: attributes.friendlyname.toString(),\n                bayesaverage: parseFloat(attributes.bayesaverage.toString()),\n                value: parseInt(attributes.value.toString()),\n                type: attributes.type.toString()\n            };\n        });\n    }\n\n    private getTagValue(tags: convert.Element[], tagName: string) {\n        const tagElement = tags.find((t) => t.name === tagName);\n        if (!(tagElement && tagElement.elements)) {\n            return undefined;\n        }\n        return tagElement.elements[0].text.toString();\n    }\n\n    private async fetchCollectionXml(username: string) {\n        const url = this.buildCollectionUrl(username);\n        return this.fethXml(url);\n    }\n\n\n    private async fetchGamesXml(ids: number[]) {\n        const url = this.buildGameUrls(ids);\n        return this.fethXml(url);\n    }\n\n\n    private async fetchPlaysXml(username: string, pageNumber: number) {\n        const url = this.buildPlaysUrl(username, pageNumber);\n        return this.fethXml(url);\n    }\n\n\n\n    private async fethXml(url: string) {\n        return this.getFetch()(url).then(async (res) => {\n            if (res.status === 200) {\n                return res.text();\n            }\n            if (res.status === 429) {\n                return { retryLater: true, backoff: true };\n            }\n            else {\n                return { retryLater: true };\n            }\n        }).catch((error: Error) => {\n            return { retryLater: true, error };\n\n        });\n    }\n\n\n    private async fetUserInfoXml(username: string) {\n        const url = this.buildUserUrl(username);\n        return this.getFetch()(url).then(async (res) => {\n            if (res.status === 429) {\n                return { error: \"backoff\" };\n            }\n            return await res.text();\n        }).catch((error: Error) => {\n            return { error };\n        });\n    }\n\n    private buildPlaysUrl(username: string, pageNumber: number) {\n        const baseUrl = `https://api.geekdo.com/xmlapi2/plays?username=${username}`;\n        return pageNumber > 1 ? (baseUrl + \"&page=\" + pageNumber) : baseUrl;\n    }\n\n    private buildGameUrls(ids: number[]) {\n        return `https://api.geekdo.com/xmlapi2/thing?id=${ids.join(\",\")}&stats=1`;\n    }\n\n    private buildCollectionUrl(username: string) {\n        return `https://api.geekdo.com/xmlapi2/collection?username=${username}&own=1&stats=1&excludesubtype=boardgameexpansion`;\n    }\n\n    private buildUserUrl(username: string) {\n        return `https://api.geekdo.com/xmlapi2/user?name=${username}`;\n    }\n\n\n}\n\n\n\nexport default BggGameService;","import * as React from \"react\";\nimport { Container, Header, Icon, Divider, List, Item, Card, Image, Button, Dimmer, Segment, Dropdown } from \"semantic-ui-react\";\nimport { FilterAndSortOptions, GameInfoPlus, GameInfo, ExtendedGameInfo, PlayTimeOption, PlayCountOption, SortOption } from \"../types\";\nimport { GamesFilterAndSorter } from \"../services/GamesFilterAndSorter\";\n\n// --- DescriptionGenerator ---\n\nconst ratingNames = [\n    \"Outstanding\",\n    \"Outstanding\",\n    \"Very good\",\n    \"Good\",\n    \"Ok\",\n    \"Mediocre\",\n    \"Not so good\",\n    \"Bad\",\n    \"Very bad\",\n    \"Awful\"\n].reverse();\n\nconst weightName = [\n    \"Very easy\",\n    \"Easy\",\n    \"Moderately difficult\",\n    \"Somewhat hard\",\n    \"Hard\",\n    \"Very Hard\"\n];\n\nconst vowel_list = \"aeiouAEIOU\";\n\n\n/**\n * Can generate a human readable describtion of a given game.\n */\nexport class DescriptionGenerator {\n\n    /**\n     * Given game information, generates a human readable description.\n     * @param gameInfo the game to generate a description for.\n     */\n    generateDescription(gameInfo: GameInfoPlus): string {\n        const rating = this.getRatingDescription(gameInfo.averagerating);\n        const family = this.getFamilyDescription(gameInfo);\n        const players = this.getPlayerInfoString(gameInfo);\n        const playtime = this.getTimeInfoString(gameInfo);\n        const aOrAn = this.getAOrAn(family);\n        let firstString = `${aOrAn} ${family} for ${players} in ${playtime}.`;\n\n        const hasWeight = (\"weight\" in gameInfo) && gameInfo.weight !== undefined;\n        if (hasWeight || gameInfo.averagerating !== undefined) {\n            firstString += ` Most people think it is `;\n        }\n        if (gameInfo.averagerating !== undefined) {\n            firstString += rating.toLowerCase();\n            if (!hasWeight) {\n                firstString += \".\";\n            }\n        }\n        if (hasWeight && gameInfo.averagerating !== undefined) {\n            firstString = firstString + \" and \";\n        }\n        if (hasWeight) {\n            const weight = this.getWeightInfo(gameInfo as ExtendedGameInfo);\n            firstString += weight + \" to learn.\";\n        }\n        return firstString;\n    }\n\n    private isVowel(input: string) {\n        return vowel_list.indexOf(input) > -1;\n    }\n\n    private getAOrAn(input: string) {\n        if (this.isVowel(input.charAt(0))) {\n            return \"An\";\n        }\n        return \"A\";\n    }\n\n    private getFamilyDescription(gameInfo: GameInfoPlus) {\n        if (gameInfo.families === undefined || gameInfo.families.length === 0) {\n            return \"boardgame\";\n        }\n        const bestFamily = gameInfo.families.sort((a, b) => a.value - b.value)[0];\n        let name = bestFamily.friendlyName.toLowerCase();\n        if (name.indexOf(\" rank\") > -1) {\n            name = name.substring(0, name.indexOf(\" rank\"));\n        }\n        if (!name.endsWith(\"game\")) {\n            name += \" game\";\n        }\n        return name;\n    }\n\n    private getRatingDescription(ratingValue?: number) {\n        const ratingIndex = Math.round(ratingValue);\n        const ratingInfo = ratingNames[ratingIndex - 1];\n        return ratingInfo ? ratingInfo : \"\";\n    }\n\n    private getPlayerInfoString(gameInfo: GameInfoPlus) {\n        let playerInfo = \"\";\n        const { minPlayers, maxPlayers } = gameInfo;\n\n        if (minPlayers === maxPlayers) {\n            playerInfo += maxPlayers + \" player\";\n        } else {\n            playerInfo += minPlayers + \" to \" + maxPlayers + \" player\";\n        }\n        if (maxPlayers > 1) {\n            playerInfo += \"s\";\n        }\n        return playerInfo;\n    }\n\n    private getTimeInfoString(gameInfo: GameInfo) {\n        let timeInfo = \"\";\n\n        const mintime = gameInfo.minPlaytime;\n        const maxtime = gameInfo.maxPlaytime;\n\n        if (mintime === maxtime) {\n            timeInfo += maxtime + \" minute\";\n        } else if (maxtime < mintime) {\n            timeInfo += mintime + \" minute\";\n        } else {\n            timeInfo += mintime + \" - \" + maxtime + \" minute\";\n        }\n        if (maxtime > 1) {\n            timeInfo += \"s\";\n        }\n        return timeInfo;\n    }\n\n    private getWeightInfo = (gameInfo: ExtendedGameInfo) => {\n        const weight = gameInfo.weight;\n        const weightIndex = Math.round((weight - 1) / 5 * 6);\n        return weightName[Math.max(weightIndex, 0)].toLowerCase();\n    }\n}\n\n// --- FilterBar ---\n\nexport interface FilterBarProps {\n    onFilterChange?: (options: FilterAndSortOptions) => any;\n    currentUsers?: string[];\n}\ninterface FilterBarState {\n    filterOptions: FilterAndSortOptions;\n}\n\ninterface TimerOptions {\n    text: string;\n    value: number;\n    playtime?: PlayTimeOption;\n}\n\ninterface PlayerCountOptions {\n    text: string;\n    value: number;\n    playercount?: PlayCountOption;\n}\n\nexport const playercountOptions: PlayerCountOptions[] = [\n    { text: \"any number of players\", value: 0, playercount: null },\n    { text: \"1 person\", value: 1, playercount: 1 },\n];\n\nfor (let i = 2; i <= 10; i++) {\n    playercountOptions.push({ text: i + \" people\", value: i, playercount: i });\n}\n\ninterface SortingOptions {\n    text: string;\n    value: number;\n    sortoption?: SortOption;\n    [\"data-testid\"]?: string;\n}\n\nconst filterBarInitialState: FilterBarState = {\n    filterOptions: {\n    }\n};\n\nexport class FilterBar extends React.Component<FilterBarProps, FilterBarState> {\n    constructor(props: FilterBarProps) {\n        super(props);\n        this.state = filterBarInitialState;\n        this.getSortOptionFromIndex = this.getSortOptionFromIndex.bind(this);\n        this.getSortOptionFromIndexSingle = this.getSortOptionFromIndexSingle.bind(this);\n        this.getDropdownValues = this.getDropdownValues.bind(this);\n        this.getSortOptions = this.getSortOptions.bind(this);\n    }\n\n    getOptions() {\n        const timeOptions: TimerOptions[] = [\n            { text: \"any time\", value: 0, playtime: null },\n            { text: \"30 minutes or less\", value: 1, playtime: { minimum: 0, maximum: 30 } },\n            { text: \"1 hour or less\", value: 2, playtime: { maximum: 60 } },\n            { text: \"2 hours or less\", value: 3, playtime: { maximum: 120 } },\n            { text: \"3 hours or less\", value: 4, playtime: { maximum: 180 } },\n            { text: \"20-60 minutes\", value: 5, playtime: { minimum: 20, maximum: 60 } },\n            { text: \"1-2 hours\", value: 6, playtime: { minimum: 60, maximum: 120 } },\n            { text: \"2-4 hours\", value: 7, playtime: { minimum: 120, maximum: 240 } },\n            { text: \"4 or more hours\", value: 8, playtime: { minimum: 240, maximum: 9999999 } },\n\n        ];\n        return timeOptions;\n    }\n\n    getSortOptions() {\n        const options = this.state.filterOptions.sortOption;\n        const allowMultiSelect = Array.isArray(options);\n        const { currentUsers = [\"Unknown\"] } = this.props;\n        const oneUser = currentUsers.length <= 1;\n        const iWe = oneUser ? \"I\" : \"we\";\n\n        const sortingOptions: SortingOptions[] = [\n            { text: \"are highly rated\", value: 0, sortoption: \"bggrating\" },\n            { text: \"are alphabetic\", value: 1, sortoption: \"alphabetic\" },\n            { text: \"are new\", value: 2, sortoption: \"new\", [\"data-testid\"]: \"sortByNew\" },\n            { text: \"are old\", value: 3, sortoption: \"old\" },\n            { text: iWe + \" rate highly\", value: 4, sortoption: \"userrating\" },\n            { text: \"are easy to learn\", value: 5, sortoption: \"weight-light\" },\n            { text: \"are complex\", value: 6, sortoption: \"weight-heavy\" },\n            { text: \"are best with this number of players\", value: 7, [\"data-testid\"]: \"suggestedPlayers\" },\n            { text: iWe + \" played recently\", value: 8, sortoption: \"playedRecently\" },\n            { text: iWe + \" haven't played in a while\", value: 9, sortoption: \"playedLongAgo\" },\n            { text: iWe + \" have played a lot\", value: 10, sortoption: \"playedALot\" },\n            { text: iWe + \" have not played a lot\", value: 11, sortoption: \"playedNotALot\" },\n        ];\n        const singlePreferenceOption: SortingOptions = { text: iWe + \" only have one preference\", value: 12, [\"data-testid\"]: \"SortBySingleOption\" };\n        const multiPreferenceOption: SortingOptions = { text: iWe + \" have multiple preferences\", value: 12, [\"data-testid\"]: \"SortByMultipleOption\" };\n        return [...sortingOptions, allowMultiSelect ? singlePreferenceOption : multiPreferenceOption];\n    }\n\n    onTimeChange(timerIndex: number) {\n        const option = this.getOptions()[timerIndex].playtime;\n        this.combineState({ playtime: option });\n    }\n\n    onPlayerCountChange(playerCountIndex: number) {\n        const option = playercountOptions[playerCountIndex].playercount;\n        const sortOption = this.state.filterOptions.sortOption;\n        if (Array.isArray(sortOption)) {\n            this.combineState({ playerCount: option, sortOption: sortOption.map((so) => typeof so === \"object\" ? Object.assign({}, this.state.filterOptions.sortOption, { numberOfPlayers: option }) : so) as any });\n        } else if (typeof sortOption === \"object\") {\n            this.combineState({ playerCount: option, sortOption: Object.assign({}, this.state.filterOptions.sortOption, { numberOfPlayers: option }) });\n        } else {\n            this.combineState({ playerCount: option });\n        }\n    }\n\n    onSortChange(sortOptionIndex: number | number[]) {\n        const currentOption = this.state.filterOptions.sortOption;\n        const clickedSwitchState = sortOptionIndex === 12 || (Array.isArray(sortOptionIndex) && sortOptionIndex.indexOf(12) > -1);\n        if (clickedSwitchState) {\n            if (Array.isArray(currentOption)) {\n                this.combineState({ sortOption: currentOption[0] });\n            } else {\n                this.combineState({ sortOption: [currentOption] });\n            }\n        } else {\n            if (Array.isArray(sortOptionIndex)) {\n                this.combineState({ sortOption: this.getSortOptionFromIndex(sortOptionIndex) as SortOption[] });\n            } else {\n                this.combineState({ sortOption: this.getSortOptionFromIndexSingle(sortOptionIndex) });\n            }\n        }\n    }\n\n\n\n    getSortOptionFromIndex(sortOptionIndex: number[]) {\n        if (sortOptionIndex.length === 0) {\n            return this.getSortOptions()[0];\n        }\n        return sortOptionIndex.map(this.getSortOptionFromIndexSingle);\n    }\n\n    getSortOptionFromIndexSingle(sortOptionIndex: number) {\n        const sortingOptions = this.getSortOptions();\n        let option = sortingOptions[sortOptionIndex].sortoption;\n        if (option === undefined && sortingOptions[sortOptionIndex].value === 7) {\n            option = {\n                type: \"suggestedPlayers\",\n                numberOfPlayers: this.state.filterOptions.playerCount\n            };\n        }\n        return option;\n    }\n\n    combineState(options: FilterAndSortOptions) {\n        const newFilter = Object.assign({}, this.state.filterOptions, options);\n        if (this.props.onFilterChange) {\n            this.props.onFilterChange(newFilter);\n        }\n        this.setState({ filterOptions: newFilter });\n    }\n\n    joinWithAndEnd(strings: string[]): string {\n        if (strings.length === 1) {\n            return strings[0];\n        }\n        const newStrings = [...strings];\n        const last = newStrings.pop();\n        return newStrings.join(\", \") + \" and \" + last;\n    }\n\n    getDropdownValues() {\n        const options = this.state.filterOptions.sortOption;\n        const sortingOptions = this.getSortOptions();\n        if (options === undefined) {\n            return undefined;\n        }\n        if (Array.isArray(options)) {\n            if (options.length === 1 && options[0] === undefined) {\n                return [];\n            }\n            return options.map((o) => typeof o === \"object\" ? 7 : sortingOptions.findIndex((so) => so.sortoption === o));\n        } else {\n            return typeof options === \"object\" ? 7 : sortingOptions.findIndex((so) => so.sortoption === options);\n        }\n    }\n\n    render() {\n\n\n        const { currentUsers = [\"Unknown\"] } = this.props;\n        const options = this.state.filterOptions.sortOption;\n        const allowMultiSelect = Array.isArray(options);\n        const oneUser = currentUsers.length <= 1;\n        const iWe = oneUser ? \"I\" : \"we\";\n        const amAre = oneUser ? \"am\" : \"are\";\n        const sortingOptions = this.getSortOptions();\n        const values = this.getDropdownValues();\n        const timeOptions = this.getOptions();\n        return (\n            <Container fluid>\n                <div className=\"topMenu ui fixed\" >\n                    <div className=\"ui container\">\n                        <span className=\"topselect\">\n                            <span>Hi {iWe}  {amAre} </span>\n                            <span><a href=\"#\"><b>{this.joinWithAndEnd(currentUsers)}</b></a></span>\n                            <span> {iWe}  {amAre} looking for a </span>\n                            <span>boardgame </span>\n                            <span className=\"topselect\">\n                                <span>that plays in </span>\n                                <Dropdown\n                                    inline={true}\n                                    placeholder=\"any time\"\n                                    data-testid=\"PlaytimeDropdown\"\n                                    options={timeOptions}\n                                    closeOnChange={true}\n                                    onChange={(_e, d) => this.onTimeChange(d.value as number)} />\n                            </span>\n                        </span>\n\n                        <span className=\"topselect\">\n                            <span>with </span>\n                            <Dropdown\n                                inline={true}\n                                placeholder=\"any number of players\"\n                                data-testid=\"PlayercountDropdown\"\n                                options={playercountOptions}\n                                closeOnChange={true}\n                                onChange={(_e, d) => this.onPlayerCountChange(d.value as number)} />\n                        </span>\n\n                        <span className=\"topselect\">\n                            <span>and {iWe} prefer games that </span>\n                            <Dropdown\n                                inline={true}\n                                placeholder={sortingOptions[0].text}\n                                data-testid=\"SortOptionDropdown\"\n                                options={this.getSortOptions()}\n                                multiple={allowMultiSelect}\n                                closeOnChange={!allowMultiSelect}\n                                value={values}\n                                onChange={(_e, d) => this.onSortChange(d.value as number[])} />\n                        </span>\n                    </div>\n                </div>\n            </Container>\n        );\n    }\n}\n\n// --- GameListItem ---\n\ntype Size = \"mini\" | \"tiny\" | \"small\" | \"medium\" | \"large\" | \"big\" | \"huge\" | \"massive\";\n\nexport interface GameListItemProps {\n    item: GameInfoPlus;\n    size?: Size;\n}\n\nconst gameDescription = new DescriptionGenerator();\n\n/**\n * PureComponent that renders  a given GameInfo item into a list like view.\n */\nexport class GameListItem extends React.PureComponent<GameListItemProps> {\n\n    render() {\n        const { item, size } = this.props;\n        const { owners = [] } = item;\n        return (\n            <Item >\n                <Item.Image size={size}><img data-testid=\"GameImage\" src={item.imageUrl} /></Item.Image>\n                <Item.Content verticalAlign={\"middle\"}>\n                    <Item.Header data-testid=\"GameName\" href={\"https://boardgamegeek.com/boardgame/\" + item.id} as=\"a\" size={size} target=\"_blank\">{item.name}</Item.Header>\n                    <Item.Meta data-testid=\"GameYear\">\n                        <span>{item.yearPublished}</span>\n                        {item.owners && <span data-testid=\"Owners\"> - <span>{owners.join(\", \")}</span></span>}\n\n                    </Item.Meta >\n                    <Item.Description data-testid=\"GameDescription\">\n                        {gameDescription.generateDescription(item)}\n                    </Item.Description>\n                    {(\"categories\" in item) && <Item.Extra>{item.categories.join(\", \")}</Item.Extra>}\n                </Item.Content>\n            </Item>\n        );\n    }\n}\n\n// --- GameCardItem ---\n\ninterface GameCardItemProps {\n    item: GameInfoPlus;\n    size?: Size;\n}\n\n/**\n * PureComponent that renders a given GameInfo item into a card view.\n */\nclass GameCardItem extends React.PureComponent<GameCardItemProps> {\n    render() {\n        const { item, size } = this.props;\n        const { owners = [] } = item;\n        return (\n            <Card size={size}>\n                <Image src={item.imageUrl} size={\"massive\"} wrapped ui={false} />\n                <Card.Content>\n                    <Card.Header>{item.name}</Card.Header>\n                    <Card.Meta>\n                        <span className=\"date\">{(item.yearPublished || \"\") + \" - \" + owners.join(\", \")}</span>\n                    </Card.Meta>\n                    <Card.Description>\n                        {gameDescription.generateDescription(item)}\n                    </Card.Description>\n                </Card.Content>\n                <Card.Content extra>\n                    {(\"categories\" in item) && item.categories && item.categories.join(\", \")}\n                </Card.Content>\n            </Card>\n        );\n    }\n}\n\n// --- PickAGameForMe ---\n\ninterface PickAGameProps {\n    games: GameInfoPlus[];\n}\n\ninterface PickAGameState {\n    pickedGame?: GameInfoPlus;\n    gamesAlreadyShown: GameInfoPlus[];\n}\n\nconst pickAGameInitialState = {\n    pickedGame: undefined,\n    gamesAlreadyShown: []\n};\n\nclass PickAGameForMe extends React.Component<PickAGameProps, PickAGameState> {\n\n    constructor(props: PickAGameProps) {\n        super(props);\n        this.state = pickAGameInitialState;\n        this.pickARandomGame = this.pickARandomGame.bind(this);\n        this.close = this.close.bind(this);\n    }\n\n    pickARandomGame() {\n        const games = this.props.games;\n        let gamesAlreadyShown = [...this.state.gamesAlreadyShown];\n        let gamesToPickFrom = games.filter((gameToPossiblyPickFrom) => gamesAlreadyShown.every((alreadyShownGame) => alreadyShownGame.id !== gameToPossiblyPickFrom.id));\n        if (gamesToPickFrom.length === 0) {\n            gamesAlreadyShown = [];\n            gamesToPickFrom = games;\n        }\n        const randomIndexDice = new Array(3).fill(0).map(() => this.randomInteger(0, gamesToPickFrom.length - 1));\n        const randomIndex = randomIndexDice.reduce((p, c) => Math.min(p, c), Math.ceil((gamesToPickFrom.length - 1) / 2));\n        const pickedGame = gamesToPickFrom[randomIndex];\n        gamesAlreadyShown.push(pickedGame);\n        this.setState({\n            pickedGame: pickedGame,\n            gamesAlreadyShown: gamesAlreadyShown\n        });\n    }\n\n    randomInteger(from: number, to: number): number {\n        return Math.floor(Math.random() * to) + from;\n    }\n\n    close() {\n        this.setState(pickAGameInitialState);\n    }\n\n    render() {\n        const pickedGame = this.state.pickedGame;\n        if (pickedGame) {\n            return (\n                <Dimmer inverted active={true} onClick={this.close}>\n                    <Container >\n                        <Segment>\n                            <Header as=\"h3\">What about this game?</Header>\n                            <Item.Group >\n                                <GameListItem size={\"large\"} item={pickedGame} />\n                            </Item.Group>\n                            <Button className=\"large\" color=\"black\" onClick={(e) => {\n                                e.stopPropagation();\n                                this.pickARandomGame();\n                            }} >\n                                <Icon name=\"cube\" />Find another\n                            </Button>\n                        </Segment>\n                    </Container>\n\n                </Dimmer >\n            );\n        } else {\n            return (\n                <Container text >\n                    <Button fluid basic onClick={(e) => {\n                        e.stopPropagation();\n                        this.pickARandomGame();\n                    }}>\n                        <Icon name=\"cube\" />Pick a game for me!\n            </Button>\n                </Container>\n            );\n        }\n    }\n}\n\n// --- CollectionList ---\n\ninterface CollectionListProps {\n    games: GameInfoPlus[];\n}\n\nclass CollectionList extends React.PureComponent<CollectionListProps> {\n    render() {\n        const { games } = this.props;\n        return (\n            <Item.Group>\n                {games.map((game) => <GameListItem key={game.id} item={game} />)}\n            </Item.Group>\n        );\n    }\n}\n\n// --- CollectionGrid ---\n\ninterface CollectionGridProps {\n    games: GameInfoPlus[];\n}\n\nclass CollectionGrid extends React.PureComponent<CollectionGridProps> {\n    render() {\n        const { games } = this.props;\n        return (\n            <Card.Group centered  >\n                {games.map((game) => <GameCardItem key={game.id} item={game} />)}\n            </Card.Group>\n        );\n    }\n}\n\n\n// --- Helper Components ---\n\nclass NoGamesFound extends React.PureComponent<Record<string, never>> {\n    render() {\n        return (\n            <Header as=\"h2\" icon textAlign=\"center\" data-testid=\"nogames\">\n                <Icon name=\"frown\" circular />\n                <Header.Content>\n                    <span >Sorry, I could not find any games that match what you are looking for.</span>\n                </Header.Content>\n            </Header>\n        );\n    }\n}\n\nclass Footer extends React.PureComponent<Record<string, never>> {\n    render() {\n        return (\n            <Container text className=\"Footer\">\n                <Divider />\n                <List horizontal>\n                    <List.Item>\n                        <Header className=\"faded\" as=\"h5\">\n                            <a href=\"about.html\">About Cardboard Butler </a>\n                        </Header >\n                    </List.Item>\n                    <List.Item>\n                        <Header className=\"faded\" as=\"h5\">\n                            <a href=\"https://github.com/PhilipK/CardboardButler\">Github Page</a>\n                        </Header >\n                    </List.Item>\n                    <List.Item>\n                        <Header className=\"faded\" as=\"h5\">\n                            <a href=\"https://boardgamegeek.com/support\">Support BGG</a>\n                        </Header >\n                    </List.Item>\n                </List>\n                <Divider hidden />\n            </Container>\n        );\n    }\n}\n\n// --- Main Component: CollectionPage ---\n\ntype ViewType = \"grid\" | \"list\";\n\ninterface Props {\n    games?: GameInfoPlus[];\n    currentUsers?: string[];\n}\n\ninterface State {\n    filterOptions: FilterAndSortOptions;\n    viewType: ViewType;\n}\n\nexport default class CollectionPage extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props);\n        this.onFilterChange = this.onFilterChange.bind(this);\n        this.onSetViewType = this.onSetViewType.bind(this);\n        this.state = { filterOptions: {}, viewType: \"list\" };\n    }\n\n    onFilterChange(filterOptions: FilterAndSortOptions) {\n        this.setState({\n            filterOptions: filterOptions\n        });\n    }\n\n    onSetViewType(viewType: ViewType) {\n        this.setState({\n            viewType: viewType\n        });\n    }\n\n    render() {\n        const { games = [], currentUsers = [] } = this.props;\n        const { viewType } = this.state;\n        const filterer = new GamesFilterAndSorter();\n        const filteredGames = filterer.filterAndSort(games, this.state.filterOptions);\n        const noGames = filteredGames.length === 0;\n        return (\n            <div data-testid=\"CollectionPage\">\n                <div style={{ position: \"absolute\", top: 20, right: 20 }}>\n                    <Icon size=\"small\" inverted={viewType === \"list\"} bordered circular name=\"list\" onClick={() => this.onSetViewType(\"list\")} />\n                    <Icon size=\"small\" inverted={viewType === \"grid\"} bordered circular name=\"grid layout\" onClick={() => this.onSetViewType(\"grid\")} />\n                </div>\n                <Container fluid textAlign=\"center\" className=\"logoHeader\">\n                    <Header as=\"h1\">\n                        <span className=\"logoscript\">Cardboard Butler</span>\n                    </Header>\n                </Container>\n                <FilterBar onFilterChange={this.onFilterChange} currentUsers={currentUsers} />\n\n                {noGames && <NoGamesFound />}\n\n                {filteredGames.length > 0 && <Container text fluid>\n                    <PickAGameForMe games={filteredGames} />\n                    <Divider hidden />\n                </Container>\n                }\n                <Container fluid text={viewType === \"list\"}>\n                    {viewType === \"list\" &&\n                        <CollectionList games={filteredGames} />\n                    }\n                    {viewType === \"grid\" &&\n                        <CollectionGrid games={filteredGames} />\n                    }\n                </Container>\n                <Footer />\n\n            </div>\n        );\n    }\n}\n","import { GameInfoPlus, GameInfo, SortOption, FilterAndSortOptions } from \"../types\";\nconst memoize = require(\"fast-memoize\");\n\n/**\n * A soter takes a collection and returns that collection sorted.\n */\nexport interface Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[];\n}\n\nexport class BggRatingSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.averageRatingSorter);\n    }\n    private averageRatingSorter(a: GameInfo, b: GameInfo): number {\n        return b.averagerating - a.averagerating;\n    }\n}\n\nexport class HeavySorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.weightHeavySort);\n    }\n    private weightHeavySort(a: GameInfoPlus, b: GameInfoPlus): number {\n        const aValue = \"weight\" in a ? a.weight : undefined;\n        const bValue = \"weight\" in b ? b.weight : undefined;\n        return (bValue || 0) - (aValue || 0);\n    }\n}\n\nexport class LightSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.weightLightSort);\n    }\n    private weightLightSort(a: GameInfoPlus, b: GameInfoPlus): number {\n        const aValue = \"weight\" in a ? a.weight : undefined;\n        const bValue = \"weight\" in b ? b.weight : undefined;\n        return (aValue || 99) - (bValue || 99);\n    }\n\n}\n\ninterface IndexMap {\n    [gameid: number]: number[];\n\n}\n\nexport class MultiSorter implements Sorter {\n\n    innerSorters: Sorter[];\n\n    constructor(innerSorters: Sorter[]) {\n        this.innerSorters = innerSorters;\n    }\n\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        const mutableCollection = [...collection];\n        const sortedCollections = this.innerSorters.map((sorter) => {\n            sorter.sort(mutableCollection);\n            return [...mutableCollection];\n        });\n        const indexMaps = sortedCollections.map((collection) => collection.reduce((prev, cur, index) => {\n            prev[cur.id] = [index];\n            return prev;\n        }, {} as IndexMap));\n        const multiScoreMap = indexMaps.reduce((prev, cur) => {\n            Object.keys(cur).forEach((gameId) => {\n                prev[gameId] = (prev[gameId] || []).concat(cur[gameId]);\n            });\n            return prev;\n        }, {} as IndexMap);\n        const combinedComparator = this.createCompareWithMap(multiScoreMap);\n        return mutableCollection.sort(combinedComparator);\n    }\n\n    private createCompareWithMap(indexMap: IndexMap) {\n        return (a: GameInfo, b: GameInfo) => {\n            const aScore = indexMap[a.id].reduce((p, c) => p + c, 0);\n            const bScore = indexMap[b.id].reduce((p, c) => p + c, 0);\n            const score = aScore - bScore;\n            return score === 0 ? indexMap[a.id][0] - indexMap[b.id][0] : score;\n        };\n    }\n\n}\n\nexport class NameSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.nameSorter);\n    }\n    private nameSorter(a: GameInfo, b: GameInfo): number {\n        return a.name.localeCompare(b.name);\n    }\n\n}\n\nexport class OldSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.oldYearSorter);\n    }\n    private oldYearSorter(a: GameInfo, b: GameInfo): number {\n        return (a.yearPublished || Infinity) - (b.yearPublished || Infinity);\n    }\n}\n\nfunction getSafePlayCount(a: GameInfoPlus) {\n    return (\"plays\" in a && a.plays && a.plays.length) || 0;\n}\n\nexport class PlayedALotSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.recentlySoter);\n    }\n    private recentlySoter(a: GameInfoPlus, b: GameInfoPlus): number {\n        return getSafePlayCount(b) - getSafePlayCount(a);\n    }\n\n}\n\nfunction getSafeLastPlayed(a: GameInfoPlus) {\n    return (\"lastPlayed\" in a && a.lastPlayed && a.lastPlayed.getTime()) || 0;\n}\n\nexport class PlayedLongAgoSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.recentlySoter);\n    }\n    private recentlySoter(a: GameInfoPlus, b: GameInfoPlus): number {\n        return getSafeLastPlayed(a) - getSafeLastPlayed(b);\n    }\n\n}\n\nexport class PlayedNotALotSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.recentlySoter);\n    }\n    private recentlySoter(a: GameInfoPlus, b: GameInfoPlus): number {\n        return getSafePlayCount(a) - getSafePlayCount(b);\n    }\n\n}\n\nexport class RecentlyPlayedSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.recentlySoter);\n    }\n    private recentlySoter(a: GameInfoPlus, b: GameInfoPlus): number {\n        return getSafeLastPlayed(b) - getSafeLastPlayed(a);\n    }\n\n}\n\nexport class SuggestedPlayersSorter implements Sorter {\n    playerCount?: number;\n\n    constructor(playerCount?: number) {\n        this.playerCount = playerCount;\n    }\n\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        if (this.playerCount !== undefined) {\n            return collection.sort(this.getSuggestedComparatorComparator(this.playerCount));\n        }\n        return collection;\n\n    }\n    private getSuggestedComparatorComparator(playerCount: number) {\n        return (a: GameInfoPlus, b: GameInfoPlus) => {\n            return this.getSuggestePlayerScore(playerCount, b) - this.getSuggestePlayerScore(playerCount, a);\n        };\n    }\n\n    private getSuggestePlayerScore(playerCount: number, gameInfo: GameInfoPlus): number {\n        if (\"suggestedNumberOfPlayers\" in gameInfo) {\n            const votes = gameInfo.suggestedNumberOfPlayers[playerCount] || gameInfo.suggestedNumberOfPlayers[Infinity];\n            if (votes !== undefined) {\n                const total = votes.best + votes.recommended + votes.notRecommended;\n                const score = (votes.best / total * 3) + (votes.recommended / total) - (votes.notRecommended / total * 2);\n                return score;\n            }\n        }\n        return -Infinity;\n\n\n    }\n}\n\nexport class UserRatingSorter implements Sorter {\n\n    constructor() {\n        this.userRatingSorter = this.userRatingSorter.bind(this);\n    }\n\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.userRatingSorter);\n    }\n\n    private userRatingSorter(a: GameInfo, b: GameInfo): number {\n        const aRating = this.getAverageUserRating(a);\n        const bRating = this.getAverageUserRating(b);\n        return (bRating || 0) - (aRating || 0);\n    }\n\n    private getAverageUserRating(a: GameInfo) {\n        const scoreMap = a.userRating;\n        if (!scoreMap) {\n            return undefined;\n        } else {\n            const userNames = Object.keys(scoreMap);\n            const userNamesWithRatings = userNames.filter((name) => scoreMap[name]);\n            if (userNamesWithRatings.length === 0) {\n                return undefined;\n            }\n            const sum = userNamesWithRatings.reduce((p, c) => p + scoreMap[c], 0);\n            return sum / userNamesWithRatings.length;\n        }\n    }\n}\n\nexport class YoungSorter implements Sorter {\n    sort(collection: GameInfoPlus[]): GameInfoPlus[] {\n        return collection.sort(this.newYearSorter);\n    }\n    private newYearSorter(a: GameInfo, b: GameInfo): number {\n        return (b.yearPublished || -100000) - (a.yearPublished || -10000);\n    }\n}\n\nconst sortMap = {\n    alphabetic: new NameSorter(),\n    bggrating: new BggRatingSorter(),\n    new: new YoungSorter(),\n    old: new OldSorter(),\n    userrating: new UserRatingSorter(),\n    \"weight-heavy\": new HeavySorter(),\n    \"weight-light\": new LightSorter(),\n    \"playedRecently\": new RecentlyPlayedSorter(),\n    \"playedLongAgo\": new PlayedLongAgoSorter(),\n    \"playedALot\": new PlayedALotSorter(),\n    \"playedNotALot\": new PlayedNotALotSorter()\n};\n\nconst DEFAULT_OPTION = \"bggrating\";\n\nfunction getSorterInner(sortOption: (SortOption | SortOption[]) = DEFAULT_OPTION): Sorter {\n    if (Array.isArray(sortOption)) {\n        const innerSorters = sortOption.map(getSorterInner);\n        return new MultiSorter(innerSorters);\n    }\n    if (typeof sortOption === \"object\") {\n        return new SuggestedPlayersSorter(sortOption.numberOfPlayers);\n    }\n    return sortMap[sortOption];\n}\n\nconst getSorter = memoize(getSorterInner);\n\n\nexport class GameSorter {\n\n    constructor() {\n        this.sortCollection = memoize(this.sortCollectionInner);\n\n    }\n\n    public sortCollection: (collection: GameInfoPlus[], sortOption: (SortOption | SortOption[])) => GameInfoPlus[];\n\n    private sortCollectionInner(collection: GameInfoPlus[], sortOption: (SortOption | SortOption[])): GameInfoPlus[] {\n        const sorter = getSorter(sortOption);\n        return sorter.sort(collection);\n    }\n\n}\n\nexport class GameFilterer {\n\n    constructor() {\n        this.filterCollectionInner = this.filterCollectionInner.bind(this);\n        this.filterCollection = memoize(this.filterCollectionInner);\n    }\n\n    public filterCollection: (collection: GameInfo[], options: FilterAndSortOptions) => GameInfo[];\n\n    private filterCollectionInner(collection: GameInfo[], options: FilterAndSortOptions) {\n        const { playtime, playerCount } = options;\n        if (playtime) {\n            collection = this.filterOnTime(collection, playtime);\n        }\n        if (playerCount) {\n            collection = this.filterOnPlayerCount(collection, playerCount);\n        }\n        return collection;\n    }\n\n    private filterOnTime(collection: GameInfo[], playtime: { minimum?: number; maximum?: number; }) {\n        const { minimum = 0, maximum = Infinity } = playtime;\n        return collection.filter((game) =>\n            minimum <= (game.minPlaytime || 0) && (game.maxPlaytime || Infinity) <= maximum\n        );\n    }\n\n    private filterOnPlayerCount(collection: GameInfo[], playerCount: number) {\n        return collection.filter((game) => game.minPlayers <= playerCount && playerCount <= game.maxPlayers);\n    }\n}\n\n/**\n * Filters and sorts a given collection and some options on how to do it.\n */\nexport class GamesFilterAndSorter {\n    sorter: GameSorter;\n    filterer: GameFilterer;\n\n    constructor(sorter: GameSorter = new GameSorter(), filterer: GameFilterer = new GameFilterer()) {\n        this.sorter = sorter;\n        this.filterer = filterer;\n        this.filterAndSortInner = this.filterAndSortInner.bind(this);\n        this.filterAndSort = memoize(this.filterAndSortInner);\n    }\n\n    /**\n     * Filters and sorts a given collection, returns a new collection.\n     * @param collection a collection of games to filter and sort\n     * @param options optional options, that defines how the collection should be filtered and sorted.\n     */\n\n    filterAndSort: (collection: GameInfoPlus[], options?: FilterAndSortOptions) => GameInfoPlus[];\n\n    filterAndSortInner(collection: GameInfoPlus[], options: FilterAndSortOptions = {}): GameInfoPlus[] {\n        const collectionCopy = [...collection];\n        const filtered = this.filterer.filterCollection(collectionCopy, options);\n        return this.sorter.sortCollection(filtered, options.sortOption);\n    }\n\n\n}\n","import BggGameService, { BggRetryResult } from \"./BggGameService\";\nimport { GameInfo, GameInfoPlus, ExtendedGameInfo, PlayInfo, GamePlayInfo } from \"../types\";\nconst memoize = require(\"fast-memoize\");\n\n// --- CollectionMerger ---\n\nexport interface CollectionMap {\n    [username: string]: GameInfo[];\n}\n\nexport interface CollectionMapPlus {\n    [username: string]: GameInfoPlus[];\n}\n\ninterface GameIdCache {\n    [id: number]: GameInfo | undefined;\n}\n\n\n/**\n * A collection merger, can merge multiple collections of game inforamtion.\n */\nexport class CollectionMerger {\n\n    /**\n    * Merges multiple collections.\n    * A single game array is returned, with one instance of each game in the collections.\n    * Each game has had its owners and userratings fields updated, to include each owner and their rating.\n    * @param collectionsMap A map between usernames and their collections\n    */\n    public getMergedCollection: (collectionsMap: CollectionMapPlus) => GameInfo[];\n\n    constructor() {\n        this.getMergedCollection = memoize(this.getMergedCollectionInner);\n    }\n\n    private getMergedCollectionInner(collectionsMap: CollectionMapPlus): GameInfo[] {\n        const cache: GameIdCache = {};\n        const sharedUserRatingSet = new Set<number>();\n        const userNames = Object.keys(collectionsMap);\n        userNames.forEach((username) => {\n            const currentCollection = collectionsMap[username];\n            currentCollection.forEach((currentGame) => {\n                const alreadyKnownGame = cache[currentGame.id];\n                if (alreadyKnownGame) {\n                    alreadyKnownGame.owners.push(username);\n                    if (currentGame.userRating) {\n                        if (!alreadyKnownGame.userRating) {\n                            alreadyKnownGame.userRating = Object.assign({}, currentGame.userRating);\n                        } else {\n                            if (sharedUserRatingSet.has(currentGame.id)) {\n                                alreadyKnownGame.userRating = Object.assign({}, alreadyKnownGame.userRating);\n                                sharedUserRatingSet.delete(currentGame.id);\n                            }\n                            Object.assign(alreadyKnownGame.userRating, currentGame.userRating);\n                        }\n                    }\n                } else {\n                    cache[currentGame.id] = Object.assign({}, currentGame, { owners: [username] });\n                    if (currentGame.userRating) {\n                        sharedUserRatingSet.add(currentGame.id);\n                    }\n                }\n            });\n        });\n        return Object.values(cache);\n    }\n}\n\n// --- BggGameLoader ---\n\n\ninterface LoadingStatus {\n    isLoading: boolean;\n    retryInfo?: BggRetryResult;\n}\n\n\ninterface GameLoadingInfo {\n    type: \"game\";\n    gameinfo: GameInfo;\n}\n\ninterface CollectionLoadingInfo {\n    type: \"collection\";\n    username: string;\n}\n\nexport interface PlaysLoadingInfo {\n    type: \"plays\";\n    username: string;\n}\nconst storageVersion = \"2\";\n\n\nexport type LoadingInfo = LoadingStatus & (GameLoadingInfo | CollectionLoadingInfo | PlaysLoadingInfo);\n\ninterface ExtraInfoMap {\n    [id: number]: (ExtendedGameInfo | undefined);\n}\n\ninterface PlaysMap {\n    [username: string]: (PlayInfo[] | undefined);\n}\n\ntype CollectionUpdateEventHandler = (games: GameInfoPlus[]) => void;\ntype LoadingUpdateEventHandler = (games: LoadingInfo[]) => void;\n\n\nexport default class BggGameLoader {\n\n    private readonly service: BggGameService;\n    private collectionMap: CollectionMapPlus = {};\n\n    private extraInfoMap: ExtraInfoMap = {};\n    private playsMap: PlaysMap = {};\n\n\n    private currentNames: string[] = [];\n    private loadingInfo: LoadingInfo[] = [];\n    private readonly eventHandlers: CollectionUpdateEventHandler[] = [];\n    private readonly loadingEventHandlers: LoadingUpdateEventHandler[] = [];\n\n    private readonly merger: CollectionMerger;\n    private useCache: boolean;\n\n\n    private concurrentRequestLimit = 5;\n\n\n    constructor(bggService: BggGameService, merger: CollectionMerger, useCache = false) {\n        this.service = bggService;\n        this.loadCollections = this.loadCollections.bind(this);\n        this.loadCollectionWithRetry = this.loadCollectionWithRetry.bind(this);\n        this.getAllGamesPlus = this.getAllGamesPlus.bind(this);\n        this.getAllGamesPlusPure = this.getAllGamesPlusPure.bind(this);\n        this.informCollectionUpdateHandlers = this.informCollectionUpdateHandlers.bind(this);\n        this.getAllGamesPlusPureMemo = memoize(this.getAllGamesPlusPure);\n        this.getShownGamesMapMemo = memoize(this.getShownGamesMap);\n        this.getGamesWithExtraInfoMemo = memoize(this.getGamesWithExtraInfo);\n        this.getGamesWithPlayInfoMemo = memoize(this.getGamesWithPlayInfo);\n        this.merger = merger;\n        this.useCache = useCache;\n        this.extraInfoMap = {};\n        this.loadCollectionsFromCache();\n        this.loadExtraInfo();\n        this.setStorageVersion();\n    }\n\n    public async loadCollections(usernames: string[]): Promise<GameInfo[][]> {\n        this.currentNames = usernames;\n        this.informCollectionUpdateHandlers();\n        return await Promise.all(usernames.map(async (username) => {\n            const games = await this.loadCollectionWithRetry(username);\n            this.collectionMap[username] = games;\n            this.storeCollections();\n            this.informCollectionUpdateHandlers();\n            return games;\n        }));\n\n    }\n\n    public async loadExtendedInfo() {\n        const allGames = this.getAllGamesPlus();\n        const allUnknownGames = allGames.filter((game) => this.extraInfoMap[game.id] === undefined);\n        const loadingInfo: LoadingInfo[] = allUnknownGames.map((game) => ({\n            type: \"game\",\n            isLoading: false,\n            gameinfo: game\n        }));\n        this.loadingInfo = [...loadingInfo, ...this.loadingInfo];\n        const chunks = this.chunk(allUnknownGames, 50);\n        return await Promise.all(chunks.map((unknownGames) => {\n            return this.loadGamesWithRetry(unknownGames).then((extraInfos) => {\n                extraInfos.forEach((extraInfo, i) => {\n                    this.extraInfoMap[unknownGames[i].id] = extraInfo;\n                });\n                this.informCollectionUpdateHandlers();\n                return extraInfos;\n            });\n        })).then((games) => {\n            this.storeExtraInfo();\n            return games;\n        });\n    }\n\n    private chunk<T>(input: T[], chunkSize: number): T[][] {\n        const chunked_arr: T[][] = [];\n        const copied = [...input];\n        const numOfChild = Math.ceil(copied.length / chunkSize);\n        for (let i = 0; i < numOfChild; i++) {\n            chunked_arr.push(copied.splice(0, chunkSize));\n        }\n        return chunked_arr;\n    }\n\n\n    private storeExtraInfo() {\n        if (localStorage && this.useCache) {\n            localStorage.setItem(\"extrainfo\", JSON.stringify(this.extraInfoMap));\n        }\n    }\n\n    private loadExtraInfo() {\n        this.extraInfoMap = {};\n        if (localStorage && this.useCache) {\n            if (localStorage.getItem(\"storageVersion\") !== storageVersion) {\n                localStorage.removeItem(\"extrainfo\");\n            }\n            const cache = JSON.parse(localStorage.getItem(\"extrainfo\")) as ExtraInfoMap;\n            if (cache) {\n                this.extraInfoMap = cache;\n            }\n        }\n    }\n    private setStorageVersion() {\n        if (localStorage && this.useCache) {\n            localStorage.setItem(\"storageVersion\", storageVersion);\n        }\n    }\n\n\n    private storeCollections() {\n        if (localStorage && this.useCache) {\n            localStorage.setItem(\"collections\", JSON.stringify(this.collectionMap));\n        }\n    }\n\n    private loadCollectionsFromCache() {\n        this.collectionMap = {};\n        if (localStorage && this.useCache) {\n            if (localStorage.getItem(\"storageVersion\") !== storageVersion) {\n                localStorage.removeItem(\"collections\");\n            }\n            const cache = JSON.parse(localStorage.getItem(\"collections\")) as CollectionMap;\n            if (cache) {\n                this.collectionMap = cache;\n            }\n        }\n    }\n\n    private getShownGamesMapMemo: (currentNames: string[], collectionMap: CollectionMap) => CollectionMap;\n    private getShownGamesMap(currentNames: string[], collectionMap: CollectionMap) {\n        return currentNames.reduce((prev, cur) => {\n            const known = collectionMap[cur];\n            if (known) {\n                prev[cur] = known;\n            }\n            return prev;\n        }, {} as CollectionMap);\n    }\n\n    private getGamesWithExtraInfoMemo: (games: GameInfo[], extraInfoMap: ExtraInfoMap) => GameInfoPlus[];\n\n    private getGamesWithExtraInfo(games: GameInfo[], extraInfoMap: ExtraInfoMap) {\n        return games.map((ag) => Object.assign({}, ag, extraInfoMap[ag.id] || {}));\n    }\n\n\n    private getGamesWithPlayInfoMemo: (currentNames: string[], games: GameInfo[], playsMap: PlaysMap) => GameInfo[];\n\n    private getGamesWithPlayInfo(currentNames: string[], games: GameInfo[], playsMap: PlaysMap) {\n        if (Object.keys(playsMap).length > 0) {\n            const allGamesWithPlays = games.map((game) => {\n                const allPlaysOfGame: PlayInfo[] = [];\n                currentNames.forEach((name) => {\n                    const usersPlays = playsMap[name];\n                    if (usersPlays) {\n                        for (let i = 0; i < usersPlays.length; i++) {\n                            const usersPlay = usersPlays[i];\n                            if (usersPlay.gameId === game.id) {\n                                allPlaysOfGame.push(Object.assign({}, usersPlay, { playedBy: name }));\n                            }\n                        }\n                    }\n                });\n\n                const lastPlayInMinutes = allPlaysOfGame.reduce((prev, cur) => Math.max(prev, cur.date.getTime()), 0);\n                const timePlayedInMinutes = allPlaysOfGame.reduce((prev, cur) => prev + (cur.length || 0), 0);\n                const result: GamePlayInfo = {\n                    plays: allPlaysOfGame,\n                    lastPlayed: lastPlayInMinutes ? new Date(lastPlayInMinutes) : undefined,\n                    timePlayedMinutes: timePlayedInMinutes\n\n                };\n                return Object.assign({}, game, result);\n            });\n            return allGamesWithPlays;\n\n        } else {\n            return games;\n        }\n    }\n\n    private getAllGamesPlus() {\n        const { currentNames, collectionMap, extraInfoMap, playsMap } = this;\n        return this.getAllGamesPlusPureMemo(currentNames, collectionMap, extraInfoMap, playsMap);\n    }\n\n    private getAllGamesPlusPureMemo: (currentNames: string[], collectionMap: CollectionMapPlus, extraInfoMap: ExtraInfoMap, playsMap: PlaysMap) => GameInfo[];\n\n    private getAllGamesPlusPure(currentNames: string[], collectionMap: CollectionMapPlus, extraInfoMap: ExtraInfoMap, playsMap: PlaysMap): GameInfo[] {\n        const shownGamesMap = this.getShownGamesMapMemo(currentNames, collectionMap);\n        const allGames = this.merger.getMergedCollection(shownGamesMap);\n        const allGamesPlus = this.getGamesWithExtraInfoMemo(allGames, extraInfoMap);\n        const allGamesPlusWithPlays = this.getGamesWithPlayInfoMemo(currentNames, allGamesPlus, playsMap);\n        return allGamesPlusWithPlays;\n    }\n\n\n\n    private informCollectionUpdateHandlers() {\n        const allGamesPlus = this.getAllGamesPlus();\n        this.eventHandlers.forEach((handler) => handler(allGamesPlus));\n    }\n\n    private informLoadingHandlers() {\n        const loadingInfo = this.getLoadingInfo();\n        this.loadingEventHandlers.forEach((handler) => handler(loadingInfo));\n    }\n\n    public async loadPlays() {\n        const names = this.currentNames;\n        return Promise.all(names.map(async (name) => {\n            this.loadingInfo = this.loadingInfo.filter((n) => n.type !== \"plays\" || (n.type === \"plays\" && n.username !== name));\n            this.loadingInfo.push({\n                isLoading: true,\n                type: \"plays\",\n                username: name\n            });\n            this.informLoadingHandlers();\n            const playerPlays = await this.loadPlaysWithRetry(name);\n            this.playsMap[name] = playerPlays;\n            this.loadingInfo = this.loadingInfo.filter((n) => n.type !== \"plays\" || (n.type === \"plays\" && n.username !== name));\n            this.informLoadingHandlers();\n            this.informCollectionUpdateHandlers();\n        }));\n    }\n\n    private async loadPlaysWithRetry(name: string): Promise<PlayInfo[]> {\n        const plays = await this.service.getPlays(name);\n        if (Array.isArray(plays)) {\n            return plays;\n        }\n        const retryTime = plays && plays.backoff ? 10000 : 1000;\n        return new Promise<PlayInfo[]>(resolver => {\n            setTimeout(() => resolver(this.loadPlaysWithRetry(name)), retryTime);\n        });\n\n    }\n\n\n    private async loadCollectionWithRetry(name: string): Promise<GameInfo[]> {\n        this.loadingInfo = this.loadingInfo.filter((n) => n.type === \"collection\" && n.username !== name);\n        this.loadingInfo.push({\n            isLoading: true,\n            type: \"collection\",\n            username: name\n        });\n        this.informLoadingHandlers();\n        const games = await this.service.getUserCollection(name);\n        if (Array.isArray(games)) {\n            this.loadingInfo = this.loadingInfo.filter((n) => n.type === \"collection\" && n.username !== name);\n            this.informLoadingHandlers();\n            return games;\n        } else {\n            const retryTime = games && games.backoff ? 10000 : 1000;\n            return new Promise<GameInfo[]>(resolver => {\n                setTimeout(() => resolver(this.loadCollectionWithRetry(name)), retryTime);\n            });\n        }\n    }\n\n    private async loadGamesWithRetry(games: GameInfo[]) {\n        const ids = games.map((g) => g.id);\n        ids.forEach((id) => {\n            const loadingIndex = this.loadingInfo.findIndex((li) => li.type === \"game\" && li.gameinfo.id === id);\n            this.loadingInfo[loadingIndex].isLoading = true;\n            this.loadingInfo[loadingIndex].retryInfo = undefined;\n        });\n        this.informLoadingHandlers();\n        const extendeds = await this.service.getGamesInfo(ids);\n        if (!(\"retryLater\" in extendeds)) {\n            ids.forEach((id) => {\n                this.loadingInfo = this.loadingInfo.filter((g) => g.type !== \"game\" || g.gameinfo.id !== id);\n            });\n            this.informLoadingHandlers();\n            return extendeds;\n        } else {\n            const retryTime = (extendeds && extendeds.backoff) ? 10000 : 3000;\n            if (extendeds && extendeds.backoff) {\n                this.concurrentRequestLimit = Math.max(this.concurrentRequestLimit - 1, 1);\n            }\n            ids.forEach((id) => {\n                const loadingIndex = this.loadingInfo.findIndex((li) => li.type === \"game\" && li.gameinfo.id === id);\n                this.loadingInfo[loadingIndex].retryInfo = extendeds;\n            });\n            this.informLoadingHandlers();\n            return new Promise<ExtendedGameInfo[]>(resolver => {\n                setTimeout(() => resolver(this.loadGamesWithRetry(games)), retryTime);\n            });\n        }\n    }\n\n    public onGamesUpdate(handler: CollectionUpdateEventHandler) {\n        this.eventHandlers.push(handler);\n    }\n\n    public getLoadingInfo(): LoadingInfo[] {\n        return this.loadingInfo;\n    }\n\n\n\n    public onLoadUpdate(handler: LoadingUpdateEventHandler) {\n        this.loadingEventHandlers.push(handler);\n    }\n\n\n}","import * as React from \"react\";\nimport { Header, Input, Icon } from \"semantic-ui-react\";\n\ninterface SelectUserInputProps {\n    bggNames?: string[];\n    onNameChange?: (newNames: string[]) => any;\n    validNames?: string[];\n    loadingNames?: string[];\n    onNameSelect?: (names: string[]) => any;\n}\n\n\n/**\n * PureComponent that renders  a given GameInfo item into a list like view.\n */\nexport class SelectUserInput extends React.PureComponent<SelectUserInputProps> {\n\n    constructor(props: SelectUserInputProps) {\n        super(props);\n        this.onInputChange = this.onInputChange.bind(this);\n        this.getNamesToShow = this.getNamesToShow.bind(this);\n        this.onAddClick = this.onAddClick.bind(this);\n        this.onDeleteClick = this.onDeleteClick.bind(this);\n        this.onUseClick = this.onUseClick.bind(this);\n    }\n\n    onInputChange(value: string, index: number) {\n        if (this.props.onNameChange) {\n            const bggNames = this.props.bggNames || [];\n            const clone = [...bggNames];\n            clone[index] = value;\n            this.props.onNameChange(clone);\n        }\n    }\n\n    onAddClick() {\n        if (this.props.onNameChange) {\n            const newNamesToShow = this.getNamesToShow().concat([\"\"]);\n            this.props.onNameChange(newNamesToShow);\n        }\n    }\n\n    onDeleteClick(index: number) {\n        if (this.props.onNameChange && this.props.bggNames) {\n            const clone = [...this.props.bggNames];\n            clone.splice(index, 1);\n            this.props.onNameChange(clone);\n        }\n    }\n\n    getNamesToShow() {\n        const { bggNames } = this.props;\n        const namesToShow = (bggNames === undefined || bggNames.length === 0) ? [\"\"] : [...bggNames];\n        return namesToShow;\n\n    }\n\n    onUseClick() {\n        const { onNameSelect } = this.props;\n        if (onNameSelect) {\n            const names = this.props.bggNames;\n            const trimmedNames = names.map((name) => name.trim());\n            onNameSelect(trimmedNames);\n        }\n    }\n\n    render() {\n        const namesToShow = this.getNamesToShow();\n        const showDelete = namesToShow.length > 1;\n        const { validNames = [], loadingNames = [] } = this.props;\n        const hasEnoughNames = namesToShow.length > 0 && namesToShow[0] !== \"\";\n        const forwardButtonText = `Can you help ${namesToShow.length === 1 ? \"me\" : \"us\"} find a game to play?`;\n        const canUseNames = hasEnoughNames && namesToShow.every((name) => validNames.indexOf(name) > -1);\n        return (\n            <div >\n                {\n                    namesToShow.map((name, i) => {\n                        const isValid = validNames.indexOf(name) > -1;\n                        const isLoading = loadingNames.indexOf(name) > -1;\n                        const isLast = i === namesToShow.length - 1;\n                        const inputName = \"Input\" + i;\n                        const isValidLabel = isValid ? { icon: \"check\", \"data-testid\": inputName + \"Valid\" } : null;\n                        const removeButton = showDelete ? (\n                            <Icon\n                                data-testid={inputName + \"Delete\"}\n                                style={{ cursor: \"pointer\" }}\n                                name=\"remove\"\n                                className=\"link\"\n                                onClick={() => this.onDeleteClick(i)}\n                            />) : null;\n\n                        return <div key={inputName} className=\"field\">\n                            <Input\n                                labelPosition=\"left corner\"\n                                placeholder=\"BGG Username\"\n                                label={isValidLabel}\n                                input={{\n                                    \"data-testid\": inputName\n                                }\n                                }\n                                icon={removeButton}\n                                loading={isLoading}\n                                value={name}\n                                data-testid={isLoading ? inputName + \"Loading\" : null}\n                                type=\"text\"\n                                autoFocus={isLast}\n                                onChange={(e) => this.onInputChange(e.target.value, i)} />\n                        </div>;\n                    }\n                    )\n                }\n                <div className=\"field\">\n                    <button data-testid=\"AddButton\" onClick={() => this.onAddClick()} className=\"ui basic button tiny\">\n                        <i className=\"icon plus\"></i>\n                        Add a friend\n                </button>\n                </div>\n                <div className=\"field\">\n                    <button data-testid=\"UseNames\"\n                        disabled={!canUseNames}\n                        onClick={this.onUseClick} className=\"ui basic button large\">\n                        {forwardButtonText}\n                    </button>\n                </div>\n            </div >\n        );\n    }\n}\n\n\ninterface Props {\n    // can ask this if user is valid or not\n    userValidator?: (name: string) => Promise<boolean>;\n    onNameSelect?: (names: string[]) => any;\n}\n\ninterface State {\n    shownNames: string[];\n    validNames: string[];\n    invalidNames: string[];\n    loadingNames: string[];\n\n}\n\n\nconst initialState: State = {\n    shownNames: [],\n    validNames: [],\n    invalidNames: [],\n    loadingNames: [],\n};\n\n\nexport default class ValidatingUserInput extends React.Component<Props, State> {\n\n    constructor(props: Props) {\n        super(props);\n        this.onNamesChange = this.onNamesChange.bind(this);\n        this.state = initialState;\n        this.doesNameNeedValidation = this.doesNameNeedValidation.bind(this);\n        this.isNameShown = this.isNameShown.bind(this);\n        this.setNameLoading = this.setNameLoading.bind(this);\n        this.setNameValidity = this.setNameValidity.bind(this);\n    }\n\n\n    private doesNameNeedValidation(name: string): boolean {\n        if (name === \"\" || name === undefined) {\n            return false;\n        }\n        const { validNames, invalidNames, loadingNames } = this.state;\n        const { userValidator } = this.props;\n        if (!userValidator) {\n            return false;\n        }\n        return !(validNames.indexOf(name) > -1)\n            && !(invalidNames.indexOf(name) > -1)\n            && !(loadingNames.indexOf(name) > -1);\n    }\n\n    private isNameShown(name: string): boolean {\n        return this.state.shownNames.indexOf(name) > -1;\n    }\n\n    private setNameLoading(name: string, loading: boolean) {\n        if (loading) {\n            this.setState({\n                loadingNames: [...this.state.loadingNames, name]\n            });\n        } else {\n            this.setState({\n                loadingNames: this.state.loadingNames.filter((loadingName) => loadingName !== name)\n            });\n        }\n    }\n\n    private setNameValidity(name: string, isValid: boolean) {\n        if (isValid) {\n            this.setState({\n                validNames: [...this.state.validNames, name]\n            });\n        } else {\n            this.setState({\n                invalidNames: [...this.state.invalidNames, name]\n            });\n        }\n    }\n\n    private onNamesChange(names: string[]) {\n        const { doesNameNeedValidation, isNameShown, setNameValidity, setNameLoading } = this;\n        const { userValidator } = this.props;\n        this.setState({\n            shownNames: names,\n        });\n        const namesToValidate = names.filter(doesNameNeedValidation);\n        namesToValidate.forEach((name) => {\n            setTimeout(async () => {\n                // things might have changed, so check again if the name is still shown\n                if (isNameShown(name) && doesNameNeedValidation(name)) {\n                    setNameLoading(name, true);\n                    const isValid = await userValidator(name);\n                    setNameValidity(name, isValid);\n                    setNameLoading(name, false);\n                }\n                // wait a little with calling validator, to make sure people are done typing.\n            }, 300);\n        });\n    }\n\n    render() {\n        const { validNames, shownNames, loadingNames } = this.state;\n        const { onNameSelect } = this.props;\n        return (\n            <div>\n                <Header as=\"h4\" style={{ marginTop: \"2em\" }}>\n                    Hi {shownNames.length <= 1 ? \"my name is\" : \"our names are\"}\n                </Header>\n                <SelectUserInput\n                    bggNames={shownNames}\n                    validNames={validNames}\n                    onNameChange={this.onNamesChange}\n                    loadingNames={loadingNames}\n                    onNameSelect={onNameSelect}\n                />\n            </div >\n        );\n    }\n}\n","var api = require(\"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../node_modules/css-loader/dist/cjs.js??ref--6-1!./App.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \"body > .grid {\\n  height: 100%;\\n}\\n.givenames {\\n  height: 100%;\\n}\\n\\n.givenames .column{\\n  max-width: 400px;\\n}\\ndiv#content{\\n  height:100%;\\n}\\n\\n\\n.main.container{\\n      margin-top:1em;\\n  }\\n\\n\\n.topMenu{\\n  background-color: white;\\n  text-align: center;\\n  padding-top: 5px;\\n  padding-bottom: 10px;\\n}\\n\\n.topselect{\\n  display: inline-block;\\n  \\n}\\n@media (max-width: 600px) {\\n  .main.container{\\n      margin-top:3em;\\n  }\\n\\n  .topMenu{\\n      text-align: center;\\n  }\\n.topselect {\\n  display: block;\\n  \\n}\\n}\\n\\n.logoscript{\\n  font-family: 'Satisfy', cursive;\\n}\\n\\n\\n.touchevents span.topselect .dropdown{\\n  font-size: 1.4em;\\n  margin-bottom: 15px;\\n} \\n\\n.logoHeader{\\n  padding: 1em;\\n}\", \"\"]);\n// Exports\nmodule.exports = exports;\n"],"sourceRoot":""}